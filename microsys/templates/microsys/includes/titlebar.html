{% load static %}
<!-- Title Bar -->
<div class="titlebar shadow-sm d-flex justify-content-between align-items-center no-print">
    <div class="d-flex align-items-center flex-grow-1" style="min-width: 0;">
        {% if request.user.is_authenticated %}
            <button id="sidebarToggle" class="sidebar-toggle ms-2 rounded flex-shrink-0">â˜°</button>
        {% endif %}
        <a class="align-items-center d-flex text-decoration-none text-inherit w-100" href="{% if user.is_authenticated %}{{ APP_CONFIG.home_url }}{% else %}/{% endif %}" style="min-width: 0;">
            <img src="{{ APP_CONFIG.logo_url|default:'/static/img/base_logo.webp' }}" alt="Logo" class="flex-shrink-0">
            <!-- Responsive Title with Smart Truncation -->
            <p class="ms-2 mb-0 align-items-center d-flex text-truncate" style="flex-shrink: 1; min-width: 0;">
                <span class="text-truncate">{{ APP_CONFIG.name|default:"microSYS" }}{% if user.scope %} - {{ user.scope.name }}{% endif %}</span>
                &nbsp;&nbsp;{% block header %}{% endblock %}
            </p>
        </a>
    </div>
        <!-- The Login Button -->
    <div class="pe-2 d-flex align-items-center">
        <!-- Extra Titlebar Controls (Dynamically injected by autofill.js) -->
        <!-- Tutorial Trigger -->
            {% if user.is_authenticated %}
        <div class="m-0 signout-wrapper">
            <button id="start-tour" type="button" class="btn btn-sm btn-outline-primary d-flex align-items-center px-2 login-title-btn titlebar-signout" title="{{ MS_TRANS.tour_title }}" aria-label="{{ MS_TRANS.help }}">
                <i class="bi bi-question-circle-fill signout-icon"></i>
                <span class="signout-name">{{ MS_TRANS.help }}</span>
                <span class="visually-hidden">{{ MS_TRANS.help }}</span>
            </button>
        </div>
        {% endif %}

    {% if user.is_authenticated %}
        <!-- Logout Button (expands to show user name on hover) -->
        <form method="POST" action="{% url 'logout' %}" class="m-0 signout-wrapper">
            {% csrf_token %}
            <button type="submit" class="btn btn-sm btn-outline-primary d-flex align-items-center px-2 login-title-btn titlebar-signout" title="{{ MS_TRANS.logout }}" aria-label="{{ MS_TRANS.logout }} {{ user.username }}" style="--signout-name-ch: {{ user.username|length }};">
                <i class="bi bi-box-arrow-left signout-icon"></i>
                <span class="signout-name">{{ user.username }}</span>
                <span class="visually-hidden">{{ MS_TRANS.logout }}</span>
            </button>
        </form>
    {% else %}
        <!-- Login Button for Unauthenticated Users (hidden on login page) -->
        {% if request.resolver_match.url_name != 'login' %}
        <a href="{% url 'login' %}" class="btn btn-sm btn-light login-title-btn me-2">
            <span class="d-none d-sm-inline">{{ MS_TRANS.login }}</span> &nbsp; <i class="bi bi-box-arrow-in-right"></i>
        </a>
        {% endif %}
    {% endif %}
    </div>
</div>
